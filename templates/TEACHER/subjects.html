<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Subjects | Quiz Master</title>

<style>
/* ================= THEME ================= */
:root{
    --bg:#0d1117;
    --panel:#161b22;
    --panel-soft:#1f2630;
    --border:#30363d;
    --text:#c9d1d9;
    --muted:#8b949e;
    --white:#f0f6fc;
    --accent:#58a6ff;
    --green:#2ea043;
    --red:#da3633;
    --radius:14px;
    --transition:.25s ease;
}

[data-theme="light"]{
    --bg:#f6f8fa;
    --panel:#ffffff;
    --panel-soft:#f1f3f5;
    --border:#d0d7de;
    --text:#24292f;
    --muted:#57606a;
    --white:#000;
}

/* ================= RESET ================= */
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
}

body{
    background:var(--bg);
    color:var(--text);
    min-height:100vh;
}

/* ================= NAVBAR ================= */
.navbar{
    position:sticky;
    top:0;
    z-index:10;
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:14px 32px;
    background:var(--panel);
    border-bottom:1px solid var(--border);
}

.brand{
    font-size:18px;
    font-weight:700;
    color:var(--white);
}

.nav-links{
    display:flex;
    gap:8px;
    align-items:center;
}

.nav-link{
    padding:8px 14px;
    border-radius:8px;
    color:var(--text);
    text-decoration:none;
    font-size:14px;
}

.nav-link.active,
.nav-link:hover{
    background:var(--panel-soft);
    color:var(--white);
}

.theme-toggle{
    cursor:pointer;
    font-size:14px;
    padding:8px 10px;
    border-radius:8px;
}

/* ================= CONTENT ================= */
.container{
    max-width:1100px;
    margin:30px auto;
    padding:0 20px;
}

.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    margin-bottom:20px;
}

.header h1{
    color:var(--white);
    font-size:26px;
}

.search-box{
    display:flex;
    gap:10px;
}

.search-box input{
    padding:10px 12px;
    border-radius:10px;
    border:1px solid var(--border);
    background:var(--panel);
    color:var(--white);
}

/* ================= GRID ================= */
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
    gap:18px;
}

/* ================= CARD ================= */
.card{
    background:linear-gradient(180deg,var(--panel),var(--panel-soft));
    border:1px solid var(--border);
    border-radius:var(--radius);
    padding:20px;
    transition:var(--transition);
}

.card h3{
    color:var(--white);
    margin-bottom:6px;
}

.card p{
    font-size:14px;
    color:var(--muted);
    margin-bottom:14px;
}

/* ================= BUTTONS ================= */
button{
    padding:8px 14px;
    border:none;
    border-radius:8px;
    font-size:13px;
    font-weight:600;
    cursor:pointer;
}

.btn-primary{background:var(--green);color:#fff;}
.btn-secondary{background:var(--accent);color:#000;}
.btn-danger{background:var(--red);color:#fff;}

.actions{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
}

/* ================= MODAL ================= */
.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:100;
}

.modal.active{display:flex;}

.modal-box{
    width:420px;
    background:var(--panel);
    border-radius:16px;
    padding:22px;
}

.modal-box input,
.modal-box textarea{
    width:100%;
    padding:10px;
    margin-bottom:10px;
    border-radius:8px;
    border:1px solid var(--border);
    background:var(--bg);
    color:var(--white);
}

/* ================= EMPTY ================= */
.empty{
    text-align:center;
    padding:60px;
    color:var(--muted);
}
</style>
</head>

<body data-theme="dark">

<!-- NAVBAR -->
<nav class="navbar">
    <div class="brand">Quiz Master</div>
    <div class="nav-links">
        <a class="nav-link" href="{{ url_for('teacher_dashboard') }}">Home</a>
        <a class="nav-link active" href="{{ url_for('teacher_subjects') }}">Subjects</a>
        <span class="theme-toggle" onclick="toggleTheme()">ðŸŒ“</span>
        <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
    </div>
</nav>

<div class="container">
    <div class="header">
        <h1>Subjects</h1>
        <div class="search-box">
            <input type="text" placeholder="Search subjectsâ€¦" onkeyup="filterSubjects(this.value)">
            <button class="btn-primary" onclick="openModal()">âž• Add</button>
        </div>
    </div>

    {% if subjects %}
    <div class="grid">
        {% for s in subjects %}
        <div class="card subject-card"
             data-name="{{ s.name|lower }}"
             data-edit-url="{{ url_for('edit_subject', subject_id=s.subject_id) }}">

            <h3>{{ s.name }}</h3>
            <p>{{ s.description or "No description" }}</p>

            <div class="actions">
                <button class="btn-secondary"
                        onclick="editSubject('{{ s.name }}','{{ s.description }}', this)">
                    Edit
                </button>

                <a href="{{ url_for('teacher_chapters', subject_id=s.subject_id) }}">
                    <button class="btn-primary">Chapters</button>
                </a>

                <!-- âœ… CONFIRM DELETE ADDED HERE -->
                <form method="POST"
                      action="{{ url_for('delete_subject', subject_id=s.subject_id) }}"
                      onsubmit="return confirm('Are you sure you want to delete this subject? This action cannot be undone.');">
                    <button class="btn-danger">Delete</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty">No subjects yet.</div>
    {% endif %}
</div>

<!-- MODAL -->
<div class="modal" id="modal">
    <div class="modal-box">
        <h3 id="modalTitle">Add Subject</h3>
        <form method="POST" action="{{ url_for('create_subject') }}" id="modalForm">
            <input type="text" name="name" id="subName" required>
            <textarea name="description" id="subDesc"></textarea>
            <button class="btn-primary" type="submit">Save</button>
            <button type="button" onclick="closeModal()">Cancel</button>
        </form>
    </div>
</div>

<script>
function openModal(){
    document.getElementById('modal').classList.add('active');
}
function closeModal(){
    document.getElementById('modal').classList.remove('active');
}

function editSubject(name, desc, btn){
    openModal();
    document.getElementById('modalTitle').innerText = 'Edit Subject';
    document.getElementById('subName').value = name;
    document.getElementById('subDesc').value = desc || '';

    const card = btn.closest('.subject-card');
    document.getElementById('modalForm').action = card.dataset.editUrl;
}

function filterSubjects(val){
    document.querySelectorAll('.subject-card').forEach(c=>{
        c.style.display = c.dataset.name.includes(val.toLowerCase()) ? 'block' : 'none';
    });
}

function toggleTheme(){
    document.body.dataset.theme =
        document.body.dataset.theme === 'dark' ? 'light' : 'dark';
}
</script>

</body>
</html>
