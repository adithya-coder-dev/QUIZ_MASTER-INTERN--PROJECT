<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Notes | Quiz Master</title>

<style>
:root{
    --bg:#0d1117;
    --panel:#161b22;
    --border:#30363d;
    --text:#c9d1d9;
    --white:#f0f6fc;
    --accent:#58a6ff;
    --green:#2ea043;
    --red:#da3633;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;}
body{background:var(--bg);color:var(--text);min-height:100vh;}

.navbar{
    display:flex;justify-content:space-between;align-items:center;
    padding:14px 28px;background:var(--panel);
    border-bottom:1px solid var(--border);
}

.brand{color:var(--white);font-size:18px;font-weight:600;}
.nav-link{color:var(--text);text-decoration:none;padding:6px 10px;border-radius:6px;}
.nav-link:hover{background:var(--border);color:var(--white);}

.container{
    max-width:1100px;
    margin:30px auto;
    padding:20px;
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:24px;
}

.card{
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:14px;
    padding:22px;
}

h2{color:var(--white);margin-bottom:14px;}

label{display:block;margin-top:12px;font-size:14px;}
input,select{
    width:100%;padding:10px;margin-top:6px;
    border-radius:8px;background:var(--bg);
    border:1px solid var(--border);color:var(--text);
}

button{
    margin-top:18px;
    background:var(--green);
    color:#fff;border:none;
    padding:10px 16px;border-radius:8px;
    font-weight:600;cursor:pointer;
}

.notes-list{display:flex;flex-direction:column;gap:12px;}

.note-item{
    background:var(--bg);
    border:1px solid var(--border);
    padding:12px;border-radius:10px;
    display:flex;justify-content:space-between;align-items:center;
}
.note-item small{opacity:.8}
.note-actions{display:flex;gap:8px;}

.note-actions button{
    padding:6px 10px;border-radius:6px;
    border:none;cursor:pointer;
}

.preview-btn{background:var(--accent);color:#000;}
.delete-btn{background:var(--red);color:#fff;}
</style>
</head>

<body>

<nav class="navbar">
    <div class="brand">Quiz Master</div>
    <div>
        <a class="nav-link" href="{{ url_for('teacher_dashboard') }}">Dashboard</a>
        <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
    </div>
</nav>

<div class="container">

<!-- UPLOAD -->
<div class="card">
    <h2>Upload Notes</h2>
    <form method="POST" enctype="multipart/form-data">

        <label>Subject</label>
        <select name="subject_id" required>
            {% for s in subjects %}
            <option value="{{ s.subject_id }}">{{ s.name }}</option>
            {% endfor %}
        </select>

        <label>Chapter</label>
        <select name="chapter_id" required>
            {% for c in chapters %}
            <option value="{{ c.chapter_id }}">{{ c.name }}</option>
            {% endfor %}
        </select>

        <label>Title</label>
        <input type="text" name="title" required>

        <label>File</label>
        <input type="file" name="file" required>

        <button type="submit">Upload</button>
    </form>
</div>

<!-- VIEW -->
<div class="card">
    <h2>Uploaded Notes</h2>

    <div class="notes-list">
    {% for n in notes %}
        <div class="note-item">
            <div>
                <strong>{{ n.title }}</strong><br>
                <small>{{ n.subject.name }} ‚Ä¢ {{ n.chapter.name }}</small>
            </div>

            <div class="note-actions">
                <button class="preview-btn"
                        onclick="openPreview('{{ n.file_path }}')">üëÅ</button>

                <form method="POST"
                      action="{{ url_for('delete_note', note_id=n.note_id) }}">
                    <button class="delete-btn">üóë</button>
                </form>
            </div>
        </div>
    {% else %}
        <p>No notes uploaded yet.</p>
    {% endfor %}
    </div>
</div>

</div>

<!-- PDF PREVIEW MODAL -->
<div id="previewModal"
     style="display:none;position:fixed;inset:0;
     background:rgba(0,0,0,.7);
     align-items:center;justify-content:center;z-index:1000;">

    <div style="width:80%;height:80%;background:#000;border-radius:12px;">
        <iframe id="pdfFrame"
                style="width:100%;height:100%;border:none;"></iframe>
    </div>
</div>

<script>
function openPreview(file){
    document.getElementById("pdfFrame").src =
        "/uploads/notes/" + file;
    document.getElementById("previewModal").style.display = "flex";
}

document.getElementById("previewModal").onclick = function(){
    this.style.display = "none";
    document.getElementById("pdfFrame").src = "";
}
</script>

</body>
</html>
